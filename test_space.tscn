[gd_scene load_steps=36 format=3 uid="uid://djvu1vrl68rpr"]

[ext_resource type="Script" path="res://Components/Pickup.gd" id="1_7k7ad"]
[ext_resource type="PackedScene" uid="uid://cmrk2f1vbqb7w" path="res://Items/Ingredients/ingredient_base.tscn" id="2_e0jvd"]
[ext_resource type="Script" path="res://Stations/Table.gd" id="3_endu1"]
[ext_resource type="Script" path="res://Components/Transformer.gd" id="3_i1ns7"]
[ext_resource type="Script" path="res://Components/Putdown.gd" id="3_i7pn2"]
[ext_resource type="Script" path="res://Stations/Cauldron.gd" id="3_vyrxq"]
[ext_resource type="Script" path="res://Components/Inventory.gd" id="6_pqxvw"]
[ext_resource type="PackedScene" uid="uid://btxb36gs2gjle" path="res://bullet.tscn" id="8_aqxf4"]
[ext_resource type="Script" path="res://Enemy.gd" id="8_bwk6e"]

[sub_resource type="GDScript" id="GDScript_nhi0n"]
script/source = "extends CharacterBody2D

const FRICTION : = 0.2
const SPEED : = 300.0
const JUMP_VELOCITY = -400.0

@onready var interaction_area : = $InteractionArea
@onready var holding_area : = $HoldingArea

# Get the gravity from the project settings to be synced with RigidBody nodes.
var gravity = ProjectSettings.get_setting(\"physics/2d/default_gravity\")

var held_item : 
	set = set_held_item

func _process(delta):
	holding_area.global_rotation = 0

func _physics_process(delta):
	var direction : = Vector2(
		Input.get_axis(\"ui_left\", \"ui_right\"),
		Input.get_axis(\"ui_up\", \"ui_down\")
	)
	if direction:
		rotation = direction.angle()
		velocity = direction * SPEED
	else:
		velocity = lerp(velocity, Vector2.ZERO, FRICTION)

	move_and_slide()

func _input(event):
	if Input.is_action_just_pressed(\"ui_accept\"):
		var areas : Array = interaction_area.get_overlapping_areas()
		for area in areas:
			if not held_item and area is Pickup:
				self.held_item = area.pickup()
				return
			elif held_item and area is Putdown:
				self.held_item = area.put_down(held_item)
				return
				
func set_held_item(new_item : Object):
	if new_item != null:
		var item_parent = new_item.get_parent()
		if item_parent:
			item_parent.remove_child(new_item)
		holding_area.add_child(new_item)
	else:
		for child in holding_area.get_children():
			child.queue_free()
	held_item = new_item










"

[sub_resource type="CircleShape2D" id="CircleShape2D_64ef5"]
radius = 16.0

[sub_resource type="Gradient" id="Gradient_3g4o5"]
interpolation_mode = 1
colors = PackedColorArray(0, 0, 0, 1, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_2xy22"]
gradient = SubResource("Gradient_3g4o5")
width = 32
height = 32
fill = 1
fill_from = Vector2(0.5, 0.5)
fill_to = Vector2(0.8, 0.1)
metadata/_snap_enabled = true

[sub_resource type="CircleShape2D" id="CircleShape2D_m10y3"]
radius = 16.0

[sub_resource type="CircleShape2D" id="CircleShape2D_baefa"]
radius = 32.0

[sub_resource type="Gradient" id="Gradient_y2gd7"]
interpolation_mode = 2
interpolation_color_space = 2
offsets = PackedFloat32Array(0.506494, 1)
colors = PackedColorArray(0.282353, 0.898039, 0.760784, 1, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_kjg2q"]
gradient = SubResource("Gradient_y2gd7")
fill = 2
fill_from = Vector2(0.5, 0.5)
metadata/_snap_enabled = true

[sub_resource type="CircleShape2D" id="CircleShape2D_kc75i"]
radius = 32.0

[sub_resource type="Gradient" id="Gradient_4ic8e"]
interpolation_mode = 1
offsets = PackedFloat32Array(0, 0.987952)
colors = PackedColorArray(0.470588, 0.443137, 0.666667, 1, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_1muup"]
gradient = SubResource("Gradient_4ic8e")
fill = 1
fill_from = Vector2(0.5, 0.5)
fill_to = Vector2(0.9, 0.2)
metadata/_snap_enabled = true

[sub_resource type="RectangleShape2D" id="RectangleShape2D_0f1af"]
size = Vector2(64, 32)

[sub_resource type="Gradient" id="Gradient_tueef"]
interpolation_mode = 1
colors = PackedColorArray(0.505882, 0.321569, 0.247059, 1, 1, 1, 1, 1)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_a4isr"]
gradient = SubResource("Gradient_tueef")
height = 32
fill = 2
fill_from = Vector2(0.5, 0.5)
metadata/_snap_enabled = true

[sub_resource type="RectangleShape2D" id="RectangleShape2D_1yrxr"]
size = Vector2(64, 32)

[sub_resource type="CircleShape2D" id="CircleShape2D_1p44d"]
radius = 32.0

[sub_resource type="Gradient" id="Gradient_8ybp2"]
interpolation_mode = 1
colors = PackedColorArray(0.054902, 0.0666667, 0.0862745, 1, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_s1lxu"]
gradient = SubResource("Gradient_8ybp2")
fill = 1
fill_from = Vector2(0.5, 0.5)
fill_to = Vector2(0.8, 0.1)
metadata/_snap_enabled = true

[sub_resource type="Curve2D" id="Curve2D_02wcr"]
_data = {
"points": PackedVector2Array(0, 0, 0, 0, 176, 640, 0, 0, 0, 0, -24, 616, 0, 0, 0, 0, -8, 496, 0, 0, 0, 0, 224, 504, 0, 0, 0, 0, 72, 368, 0, 0, 0, 0, -120, 360, 0, 0, 0, 0, -120, 216, 0, 0, 0, 0, 136, 152, 0, 0, 0, 0, 136, 152, 0, 0, 0, 0, 0, 0)
}
point_count = 10

[sub_resource type="GDScript" id="GDScript_wlqlu"]
script/source = "extends Line2D


# Called when the node enters the scene tree for the first time.
func _ready():
	var path : Path2D = get_parent()
	for point in path.curve.get_baked_points():
		add_point(point)
"

[sub_resource type="GDScript" id="GDScript_n671w"]
script/source = "extends PathFollow2D

@export var SPEED : = 0.5


func _process(delta):
	progress += SPEED
"

[sub_resource type="GDScript" id="GDScript_4no1w"]
script/source = "extends StaticBody2D

@export var bullet_scene : PackedScene
@export var shoot_speed : = 1000.0
@export var cooldown : = 1.0
@onready var range : = $Range

var cooldown_timer : = 0.0

func _process(delta):
	cooldown_timer += delta
	if cooldown_timer >= cooldown and range.has_overlapping_areas():
		var target = range.get_overlapping_areas()[0]
		shoot_at(target.global_position)
		cooldown_timer = 0.0
		
func shoot_at(pos : Vector2):
	var bullet : RigidBody2D = bullet_scene.instantiate()
	add_sibling(bullet)
	var dir : = global_position.direction_to(pos)
	bullet.global_position = global_position + (dir * 16)
	bullet.apply_central_impulse(dir * shoot_speed) 
"

[sub_resource type="CircleShape2D" id="CircleShape2D_sttef"]

[sub_resource type="Gradient" id="Gradient_qb8oi"]
interpolation_mode = 1
colors = PackedColorArray(0.63, 0.2835, 0.462525, 1, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_logy6"]
gradient = SubResource("Gradient_qb8oi")
width = 32
height = 32
fill = 1
fill_from = Vector2(0.5, 0.5)
fill_to = Vector2(0.8, 0.1)
metadata/_snap_enabled = true

[sub_resource type="CircleShape2D" id="CircleShape2D_sl1ki"]
radius = 128.0

[node name="TestSpace" type="Node2D"]

[node name="CharacterBody2D" type="CharacterBody2D" parent="."]
position = Vector2(544, 192)
script = SubResource("GDScript_nhi0n")

[node name="HoldingArea" type="Node2D" parent="CharacterBody2D"]
z_index = 1

[node name="CollisionShape2D" type="CollisionShape2D" parent="CharacterBody2D"]
shape = SubResource("CircleShape2D_64ef5")

[node name="Sprite2D" type="Sprite2D" parent="CharacterBody2D"]
texture = SubResource("GradientTexture2D_2xy22")

[node name="InteractionArea" type="Area2D" parent="CharacterBody2D"]
position = Vector2(32, 0)

[node name="CollisionShape2D" type="CollisionShape2D" parent="CharacterBody2D/InteractionArea"]
shape = SubResource("CircleShape2D_m10y3")

[node name="Transmutation" type="Area2D" parent="."]
z_index = -1
position = Vector2(-384, 176)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Transmutation"]
shape = SubResource("CircleShape2D_baefa")

[node name="Sprite2D" type="Sprite2D" parent="Transmutation"]
texture = SubResource("GradientTexture2D_kjg2q")

[node name="Pickup" type="Area2D" parent="Transmutation"]
script = ExtResource("1_7k7ad")
item_scene = ExtResource("2_e0jvd")
infinite = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="Transmutation/Pickup"]
shape = SubResource("CircleShape2D_baefa")

[node name="Putdown" type="Node2D" parent="Transmutation"]

[node name="Transformer" type="Node2D" parent="Transmutation"]

[node name="SummonCircle" type="Area2D" parent="."]
z_index = -1
position = Vector2(-256, 176)

[node name="CollisionShape2D" type="CollisionShape2D" parent="SummonCircle"]
shape = SubResource("CircleShape2D_kc75i")

[node name="Sprite2D" type="Sprite2D" parent="SummonCircle"]
texture = SubResource("GradientTexture2D_1muup")

[node name="Pickup" type="Node2D" parent="SummonCircle"]

[node name="Putdown" type="Node2D" parent="SummonCircle"]

[node name="Transformer" type="Node2D" parent="SummonCircle"]

[node name="PotionIngredients" type="StaticBody2D" parent="."]
position = Vector2(-384, 48)

[node name="CollisionShape2D" type="CollisionShape2D" parent="PotionIngredients"]
shape = SubResource("RectangleShape2D_0f1af")

[node name="Sprite2D" type="Sprite2D" parent="PotionIngredients"]
texture = SubResource("GradientTexture2D_a4isr")

[node name="Pickup" type="Area2D" parent="PotionIngredients"]
script = ExtResource("1_7k7ad")
item_scene = ExtResource("2_e0jvd")

[node name="CollisionShape2D" type="CollisionShape2D" parent="PotionIngredients/Pickup"]
shape = SubResource("RectangleShape2D_1yrxr")

[node name="Table" type="StaticBody2D" parent="."]
z_index = -1
position = Vector2(-128, 48)
script = ExtResource("3_endu1")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Table"]
shape = SubResource("RectangleShape2D_0f1af")

[node name="Sprite2D" type="Sprite2D" parent="Table"]
texture = SubResource("GradientTexture2D_a4isr")

[node name="Inventory" type="Node2D" parent="Table"]
script = ExtResource("6_pqxvw")
max_capacity = 10

[node name="Putdown" type="Area2D" parent="Table"]
script = ExtResource("3_i7pn2")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Table/Putdown"]
shape = SubResource("RectangleShape2D_1yrxr")

[node name="Pickup" type="Area2D" parent="Table" node_paths=PackedStringArray("inventory")]
script = ExtResource("1_7k7ad")
infinite = false
inventory = NodePath("../Inventory")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Table/Pickup"]
shape = SubResource("RectangleShape2D_1yrxr")

[node name="Cauldron" type="StaticBody2D" parent="."]
z_index = -1
position = Vector2(-128, 176)
script = ExtResource("3_vyrxq")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Cauldron"]
shape = SubResource("CircleShape2D_1p44d")

[node name="Sprite2D" type="Sprite2D" parent="Cauldron"]
texture = SubResource("GradientTexture2D_s1lxu")

[node name="Pickup" type="Area2D" parent="Cauldron" node_paths=PackedStringArray("inventory")]
script = ExtResource("1_7k7ad")
item_scene = ExtResource("2_e0jvd")
infinite = false
inventory = NodePath("../Inventory")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Cauldron/Pickup"]
shape = SubResource("CircleShape2D_1p44d")

[node name="Node2D" type="Node2D" parent="Cauldron/Pickup"]

[node name="Putdown" type="Area2D" parent="Cauldron"]
script = ExtResource("3_i7pn2")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Cauldron/Putdown"]
shape = SubResource("CircleShape2D_1p44d")

[node name="HoldingArea" type="Node2D" parent="Cauldron/Putdown"]
position = Vector2(0, -8)
rotation = -0.785397

[node name="Transformer" type="Node2D" parent="Cauldron"]
script = ExtResource("3_i1ns7")

[node name="Inventory" type="Node2D" parent="Cauldron"]
script = ExtResource("6_pqxvw")

[node name="TownEntrance" type="Node2D" parent="."]
position = Vector2(528, 8)

[node name="TDPath" type="Path2D" parent="TownEntrance"]
curve = SubResource("Curve2D_02wcr")

[node name="Line2D" type="Line2D" parent="TownEntrance/TDPath"]
width = 2.0
script = SubResource("GDScript_wlqlu")

[node name="PathFollow2D" type="PathFollow2D" parent="TownEntrance/TDPath"]
position = Vector2(176, 640)
rotation = -3.02216
script = SubResource("GDScript_n671w")

[node name="Enemy" type="Area2D" parent="TownEntrance/TDPath/PathFollow2D"]
script = ExtResource("8_bwk6e")

[node name="CollisionShape2D" type="CollisionShape2D" parent="TownEntrance/TDPath/PathFollow2D/Enemy"]
shape = SubResource("CircleShape2D_64ef5")

[node name="Label" type="Label" parent="TownEntrance/TDPath/PathFollow2D/Enemy"]
top_level = true
offset_right = 79.0
offset_bottom = 23.0
text = "Health: 10"

[node name="Sprite2D" type="Sprite2D" parent="TownEntrance/TDPath/PathFollow2D/Enemy"]
texture = SubResource("GradientTexture2D_2xy22")

[node name="Tower" type="StaticBody2D" parent="TownEntrance"]
position = Vector2(96, 448)
script = SubResource("GDScript_4no1w")
bullet_scene = ExtResource("8_aqxf4")

[node name="CollisionShape2D" type="CollisionShape2D" parent="TownEntrance/Tower"]
shape = SubResource("CircleShape2D_sttef")

[node name="Sprite2D" type="Sprite2D" parent="TownEntrance/Tower"]
texture = SubResource("GradientTexture2D_logy6")

[node name="Range" type="Area2D" parent="TownEntrance/Tower"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="TownEntrance/Tower/Range"]
shape = SubResource("CircleShape2D_sl1ki")
